# Что происходит после ввода адреса в браузер? - Custom

У нас есть адрес сайта, на который мы хотим попасть - https://github.com/OboyaShka

Для браузера важны 3 вещи
- Протокол (http)
- Домен (github.com)
- Ресурс (OboyaShka / Может быть физическим или виртуальным)

## Шаг первый - DNS Resolve.

Для открытия TCP/IP соединения и получения нужного ресурса, браузеру нужен IP адрес, стоящий за доменным именем. Для этого браузер использует DNS (Domain Name System).

Делает это он по следующему алгоритму:
1) Есть ли нужный ip в локальном кеше браузера
2) Есть ли нужный ip в /etc/hosts
3) Браузер подключается к Local DNS Resolver (Предоставляет провайдер связи) и проверяет кеш
4) Local DNS Resolver обращается к Root server, который возвращает адрес TLD (Top level domain / .com / .ru / etc...)
5) Local DNS Resolver обращается к TLD, который возвращает адрес Host server
6) Local DNS Resolver обращается к Host server, который возвращает нужный адрес
7) Local DNS Resolver обращается к выданному ip адресу и проверяет его на доступность/соединение и при удачном ответе кеширует
8) Local DNS Resolver возвращает нужный браузеру ip адрес

![image](https://user-images.githubusercontent.com/66056854/236718962-3651d72e-8fda-4b0e-ab5c-40afebc33d80.png)

## Шаг второй - Handshake.

Так как для TCP/IP соединения важен порт подключения, его нужно узнать. Для протокола http используется 80, а для https 433 порт.
Имея IP адрес, порт и ресурс можно открыть TCP/IP соединение. Но так как https это протокол предоставляющий защищённое соединение с шифрованием отправленных данных, между сервером и клиентом должна пройти фаза рукопожатия (Handshake).

Все TCP-соединения начинаются с тройного рукопожатия. До того как клиент и сервер могут обменяться любыми данными приложения, они должны «договориться» о начальном числе последовательности пакетов, а также о ряде других переменных, связанных с этим соединением. Числа последовательностей выбираются случайно на обоих сторонах ради безопасности.
- SYN Клиент выбирает случайное число Х и отправляет SYN-пакет, который может также содержать дополнительные флаги TCP и значения опций.
- SYN ACK Сервер выбирает свое собственное случайное число Y, прибавляет 1 к значению Х, добавляет свои флаги и опции и отправляет ответ.
- АСК Клиент прибавляет 1 к значениям Х и Y и завершает хэндшейк, отправляя АСК-пакет.

1) Браузер отправляет серверу набор алгоритмов шифрования с которыми он умеет работать (Для аутенфикации соединения используется асимметричные алгоритмы)
2) Сервер в ответ на это отправляет свой SSL сертификат и публичный ключ
3) Браузер проверяет SSL сертификат и отправляет свой публичный ключ
4) Благодаря алгоритму обмена ключами сервер и клиент обладают общим секретным ключом с помощью которого могут шифровать весь последующий трафик (симметричное шифрование) 

![image](https://user-images.githubusercontent.com/66056854/236722595-3562e569-403f-402a-8f54-6af2fe28fa06.png)

![image](https://user-images.githubusercontent.com/66056854/236721514-9bce6ea5-3a9e-40af-bbc2-81feb923fd83.png)

## Шаг третий - WebServer

После того как соединение установлено, мы можем получить нужные нам данные, например статический html файл. Но современные веб-приложения обслуживают большое количество пользователей, поэтому появилась надобность в прослойке веб-сервере (nginx/apache/etc...), которая играет роль распределителя нагрузки.

Веб-сервер перенаправляет запросы на менее загруженные сервера.

![image](https://user-images.githubusercontent.com/66056854/236723672-5ba8a76e-c327-4911-ab56-3dc695d5f6b6.png)

## Шаг четвёртый - Page rendering

На сервер посылается HTTP запрос. Важную часть играют заголовки, сообщающие серверу, как можно работать с клиентом.

Вот некоторые из них:
- Method (get)
- HTTP version (2.0, SPDY)
- Host (Начиная с 1.0 есть поддержка виртуальных хостов)
- connection (close / keep-alive, отключать ли tcp соединение)

Если всё успешно, возвращается статус код 200 вместе с html страницей, после чего запускается процесс парсинга. Парсинг не происходит за один обход и его алгоритм достаточно сложный. Происходит синтаксический, лексический анализ, создание DOM и CSSOM. После чего происходит создание rendering tree, вычисление позиций каждого элемента и отрисовки.

В целом схема выглядит следующим образом.
![image](https://user-images.githubusercontent.com/66056854/236726335-a0c59ca1-1f1c-4444-9a66-8cd94c821a44.png)

А теперь подробнее про каждый этап.

### 
