# [Как мы разрабатываем новый фронтенд Tinkoff.ru](https://habr.com/ru/companies/tinkoff/articles/303580/)

Tinkoff.ru как и сайт любого сложного веб-приложения имеет свою историю. С 2011 года на портале поменялось несколько стеков:
## 2011. Портал и интернет-банк. 
Бэк Java/Spring, фронт jQuery, Backbone, Handlebars.
Maven собирал фронт с бэком. Было катастрофически мало плагинов для фронта, так как Maven не подходил для сборки клиентских пакетов.
Использовать шаблоны на сервере и несвязанные шаблоны на клиенте со своей логикой и архитектурой считалось нормой. Приходилось поддерживать два UI-слоя: серверный UI и клиентский UI, что вносило много проблем.
Но веб продолжал двигаться в сторону разделение серверной и ui логики, что привело к смене стека.

## 2014. Кошелек
Приложение было первым на новой MVC архитектуре, Стэк был схож с интернет-банком: Backbone и Handlebars, сервер на Node.js. Часть вью рендерилось на сервере. Приложение решало свои задачи и даже получился один UI-слой. Но стало ясно, что на большом приложении подобная архитектура принесет сложности. Появились проблемы с обогащением моделей данных в браузере. Приходилось писать отдельные контроллеры для серверной и клиентской стороны.

## 2015 Интернет-банк
Интернет-банк был отделен от внешнего сайта и представлял из себя Single Page Application. Для интернет-банка использовали фреймворк Angular.js.
Но были проблемы с SSR SPA, а также 2 UI слоя, которые нужно поддерживать. Что привело к пересмотру подхода.

## 2016 Платформа 
За основу этой системы была выбрана Flux, которую предложили инженеры Facebook в 2014 году. Flux отличается от MV* тем, что в нем отсутствуют разнонаправленные потоки данных, что легче ложится на изоморфную парадигму и всё это помогает быстрее отлаживать приложение. Архитектура Flux взяла за основу модель работы с базой данных CQRS.
В качестве шаблонизатора React.js с поддержкой виртуального DOM. Благодаря которому шаблоны легко рендерятся на сервере.
Сложившийся стэк решает задачи SEO и SMM. Переиспользует код между браузером и сервером, за исключением специфичного для окружения кода, например работа с cookies. Позволяет решать весь спектр задач одной группой разработчиков, что приводит к ускорению работы. Не зависит от одного фреймворка/вендора. Приложение объединяется набором правил, выстраивается из небольших и независимых модулей. Модуль можно заменить, если будет более подходящая реализация.

Практики нового стека:
- SSR. Можно рендерить все данные на сервере, можно ренедрить часть. А можно полностью отключить серверную часть и использовать приложение как SPA. Чтобы сократить нагрузку на сервера, рендер только общие данные для всех пользователей, а работу с персональными данными выполняем в браузере.
- Разделение на коннекторы и чистые компоненты
- Higher-order Components
- Оптимизация
- Cashe (кэширование шаблонов)
